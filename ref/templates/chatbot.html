{% extends "base.html" %}

{% block title %}Shopping Assistant - Grocer-Ease{% endblock %}

{% block head %}
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Chat Interface -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-robot me-2"></i>Shopping Assistant
                    </h5>
                </div>
                <div class="card-body d-flex flex-column">
                    <!-- Chat Messages -->
                    <div id="chat-messages" class="flex-grow-1 overflow-auto mb-3" style="height: 400px;">
                        <div class="message bot-message">
                            <div class="message-content">
                                <strong>Assistant:</strong> Hello! I'm here to help you with your grocery shopping. What would you like to add to your list today?
                            </div>
                            <small class="text-muted">Just now</small>
                        </div>
                        
                        {% for message in chat_history %}
                        <div class="message {{ 'user-message' if message.sender == 'user' else 'bot-message' }}">
                            <div class="message-content">
                                <strong>{{ 'You' if message.sender == 'user' else 'Assistant' }}:</strong> {{ message.message }}
                            </div>
                            <small class="text-muted">{{ message.timestamp }}</small>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Chat Input -->
                    <form id="chat-form" class="d-flex">
                        <input type="text" id="message-input" class="form-control me-2" 
                               placeholder="Ask me about products or tell me what you need..." required>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Shopping List Sidebar -->
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list-ul me-2"></i>Shopping List
                        <span class="badge bg-primary text-white ms-2" id="list-count">{{ shopping_list|length }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div id="shopping-list">
                        {% if shopping_list %}
                            {% for item in shopping_list %}
                            <div class="shopping-item mb-3" data-item-id="{{ item.item_id }}">
                                <div class="d-flex align-items-center">
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}" class="item-image me-3">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ item.name }}</h6>
                                        <small class="text-muted">Qty: {{ item.quantity }}</small>
                                        {% if item.face_id %}
                                        <br><small class="text-info">Location: {{ item.face_id }}</small>
                                        {% endif %}
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger remove-item" data-item-id="{{ item.item_id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                        <div class="text-center text-muted" id="empty-list">
                            <i class="fas fa-shopping-basket fa-3x mb-3"></i>
                            <p>Your shopping list is empty.</p>
                            <p class="small">Ask the assistant to add items!</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
<script src="{{ url_for('static', filename='js/shopping_list.js') }}"></script>
{% endblock %}
